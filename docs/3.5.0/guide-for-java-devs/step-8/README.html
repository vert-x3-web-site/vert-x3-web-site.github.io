<!DOCTYPE html>
<html lang="en">
<head>
  <title>Reactive programming with RxJava - Vert.x</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="Eclipse Vert.x is a tool-kit for building reactive applications on the JVM." name="description">
  <link href="http://vertx.io/stylesheets/docs.css" media="screen" rel="stylesheet">
  <link href="http://vertx.io/stylesheets/font-awesome.min.css" media="screen" rel="stylesheet">
  <link href="http://vertx.io/javascripts/styles/rainbow.min.css" media="screen" rel="stylesheet">
  <!-- IE 6-8 support of HTML 5 elements -->
  <!--[if lt IE 9]>
  <script src="http://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script>
  <![endif]-->

  <link rel="apple-touch-icon" sizes="57x57" href="http://vertx.io/assets/favicons/vertx-favicon-7/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="http://vertx.io/assets/favicons/vertx-favicon-7/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="http://vertx.io/assets/favicons/vertx-favicon-7/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="http://vertx.io/assets/favicons/vertx-favicon-7/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="http://vertx.io/assets/favicons/vertx-favicon-7/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="http://vertx.io/assets/favicons/vertx-favicon-7/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="http://vertx.io/assets/favicons/vertx-favicon-7/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="http://vertx.io/assets/favicons/vertx-favicon-7/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="http://vertx.io/assets/favicons/vertx-favicon-7/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="http://vertx.io/assets/favicons/vertx-favicon-7/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="http://vertx.io/assets/favicons/vertx-favicon-7/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="http://vertx.io/assets/favicons/vertx-favicon-7/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="http://vertx.io/assets/favicons/vertx-favicon-7/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="http://vertx.io/assets/favicons/vertx-favicon-7/manifest.json">
  <link rel="mask-icon" href="http://vertx.io/assets/favicons/vertx-favicon-7/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#7d3194">
  <meta name="msapplication-TileImage" content="http://vertx.io/assets/favicons/vertx-favicon-7/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link href="http://fonts.googleapis.com/css?family=Ubuntu:400,500,700,400italic" rel="stylesheet" type="text/css">
  <link rel="alternate" type="application/rss+xml" title="RSS"
     href="http://vertx.io/feed.xml">
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-30144458-1', 'auto');
    ga('create', 'UA-71153120-1', 'auto', 'tracker');
    ga('send', 'pageview');
    ga('tracker.send', 'pageview');
  </script>
</head>
<body>

<a href="http://www.reactivemanifesto.org/" id="reactive-manifesto-banner">
  <img style="border: 0; position: fixed; right: 0; top:0; z-index: 9000"
    src="http://d379ifj7s9wntv.cloudfront.net/reactivemanifesto/images/ribbons/we-are-reactive-black-right.png">
</a>

<a id="skippy" class="sr-only sr-only-focusable" href="#content"><div class="container"><span class="skiplink-text">Skip to main content</span></div></a>

<header class="navbar navbar-default navbar-static-top" id="top" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#vertx-navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="http://vertx.io/" class="navbar-brand"><img alt="Brand" src="http://vertx.io/assets/logo-sm.png"></a>
    </div>
    <nav class="collapse navbar-collapse" id="vertx-navbar-collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="http://start.vertx.io">Starter</a></li>
        <li><a href="http://vertx.io/download/">Download</a></li>
        <li><a href="http://vertx.io/docs/3.5.0/">Documentation</a></li>
        <li><a href="https://github.com/vert-x3/wiki/wiki">Wiki</a></li>
        <li><a href="http://vertx.io/community/">Community</a></li>
        <li><a href="http://vertx.io/materials/">Materials</a></li>
        <li><a href="http://vertx.io/blog/">Blog</a></li>
      </ul>
    </nav>
  </div>
</header>



  <div class="page-header" id="content">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <h1>Reactive programming with RxJava</h1>
          
        </div>
      </div>
    </div>
  </div>



<div id="content">
  <div class="container docs-content">
    <div class="row">
      <div class="col-sm-12 col-md-push-9 col-md-3 hidden-xs hidden-sm">
        <div id="sidebar" data-spy="affix">
          <ul class="sectlevel1">
<li><a href="#_enabling_the_rxjava_apis">Enabling the RxJava APIs</a></li>
<li><a href="#_deploying_verticles_in_order">Deploying verticles in order</a></li>
<li><a href="#_partially_em_rxifying_em_code_httpserververticle_code">Partially <em>"Rxifying"</em> <code>HttpServerVerticle</code></a>
<ul class="sectlevel2">
<li><a href="#_import_rxjava_versions_of_vert_x_classes">Import RxJava versions of Vert.x classes</a></li>
<li><a href="#_use_delegate_on_a_em_rxified_em_code_vertx_code_instance">Use delegate on a <em>"Rxified"</em> <code>vertx</code> instance</a></li>
</ul>
</li>
<li><a href="#_executing_authorization_queries_concurrently">Executing authorization queries concurrently</a></li>
<li><a href="#_working_with_database_connections">Working with database connections</a></li>
<li><a href="#_bridging_the_gap_between_callbacks_and_rxjava">Bridging the gap between callbacks and RxJava</a></li>
<li><a href="#_data_flows">Data flows</a></li>
</ul>
        </div>
      </div>
      <div class="col-sm-12 col-md-pull-3 col-md-9">
        <div class="toc hidden-md hidden-lg">
          <h2>Table of Contents</h2>
          <ul class="sectlevel1">
<li><a href="#_enabling_the_rxjava_apis">Enabling the RxJava APIs</a></li>
<li><a href="#_deploying_verticles_in_order">Deploying verticles in order</a></li>
<li><a href="#_partially_em_rxifying_em_code_httpserververticle_code">Partially <em>"Rxifying"</em> <code>HttpServerVerticle</code></a>
<ul class="sectlevel2">
<li><a href="#_import_rxjava_versions_of_vert_x_classes">Import RxJava versions of Vert.x classes</a></li>
<li><a href="#_use_delegate_on_a_em_rxified_em_code_vertx_code_instance">Use delegate on a <em>"Rxified"</em> <code>vertx</code> instance</a></li>
</ul>
</li>
<li><a href="#_executing_authorization_queries_concurrently">Executing authorization queries concurrently</a></li>
<li><a href="#_working_with_database_connections">Working with database connections</a></li>
<li><a href="#_bridging_the_gap_between_callbacks_and_rxjava">Bridging the gap between callbacks and RxJava</a></li>
<li><a href="#_data_flows">Data flows</a></li>
</ul>
        </div>
        <div id="preamble">
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The corresponding source code is in the <code>step-8</code> folder of the guide repository.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So far we have explored various areas of the Vert.x stack, using the callback-based APIs.
It just works and this programming model is well-known from developers in many languages.
However, it can become a bit tedious, especially when you combine several sources of events, or deal with complex data flows.</p>
</div>
<div class="paragraph">
<p>This is exactly where RxJava shines, and Vert.x integrates with it seamlessly.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_the_rxjava_apis">Enabling the RxJava APIs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to the callback-based API, the Vert.x modules offer an <em>"Rxified"</em> API.
To enable it, start by adding the <code>vertx-rx-java</code> module to the Maven POM file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>io.vertx<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>vertx-rx-java<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Verticles then have to be modified so that they extend <code>io.vertx.rxjava.core.AbstractVerticle</code> instead of <code>io.vertx.core.AbstractVerticle</code>.
How is this different? The former class extends the latter and exposes a <code>io.vertx.rxjava.core.Vertx</code> field.</p>
</div>
<div class="paragraph">
<p><code>io.vertx.rxjava.core.Vertx</code> defines extra <code>rxSomething(&#8230;&#8203;)</code> methods that are equivalent to their callback-based counterparts.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at the <code>MainVerticle</code> to get a better idea of how it works in practice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Single&lt;<span class="predefined-type">String</span>&gt; dbVerticleDeployment = vertx.rxDeployVerticle(
  <span class="string"><span class="delimiter">&quot;</span><span class="content">io.vertx.guides.wiki.database.WikiDatabaseVerticle</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>rxDeploy</code> method does not take a <code>Handler&lt;AsyncResult&lt;String&gt;&gt;</code> as final parameter.
Instead, it returns a <code>Single&lt;String&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Besides, the operation does not start when the method is called.
It starts when you subscribe to the <code>Single</code>.
When the operation completes, it emits the deployment <code>id</code> or signals the cause of the problem with a <code>Throwable</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploying_verticles_in_order">Deploying verticles in order</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To finalize the <code>MainVerticle</code> refactoring, we must make sure the deployment operations get triggered and happen in order:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">dbVerticleDeployment
  .flatMap(id -&gt; { <b class="conum">(1)</b>

    Single&lt;<span class="predefined-type">String</span>&gt; httpVerticleDeployment = vertx.rxDeployVerticle(
      <span class="string"><span class="delimiter">&quot;</span><span class="content">io.vertx.guides.wiki.http.HttpServerVerticle</span><span class="delimiter">&quot;</span></span>,
      <span class="keyword">new</span> DeploymentOptions().setInstances(<span class="integer">2</span>));

    <span class="keyword">return</span> httpVerticleDeployment;
  })
  .subscribe(id -&gt; startFuture.complete(), startFuture::fail); <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>flatMap</code> operator applies the function to the result of <code>dbVerticleDeployment</code>. Here it schedules the deployment of the <code>HttpServerVerticle</code>.</p>
</li>
<li>
<p>Operations start when subscribing. On success or on error, the <code>MainVerticle</code> start future is either completed or failed.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_partially_em_rxifying_em_code_httpserververticle_code">Partially <em>"Rxifying"</em> <code>HttpServerVerticle</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you follow the guide in sequence, editing the code as you go, your <code>HttpServerVerticle</code> class is still using the
callback-based API. Before you can use the RxJava API to execute asynchronous operations <em>naturally</em>, i.e.
<strong><em>concurrently</em></strong>, you need to refactor <code>HttpServerVerticle</code>.</p>
</div>
<div class="sect2">
<h3 id="_import_rxjava_versions_of_vert_x_classes">Import RxJava versions of Vert.x classes</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.vertx.rxjava.core.AbstractVerticle</span>;
<span class="keyword">import</span> <span class="include">io.vertx.rxjava.core.http.HttpServer</span>;
<span class="keyword">import</span> <span class="include">io.vertx.rxjava.ext.auth.AuthProvider</span>;
<span class="keyword">import</span> <span class="include">io.vertx.rxjava.ext.auth.User</span>;
<span class="keyword">import</span> <span class="include">io.vertx.rxjava.ext.auth.jwt.JWTAuth</span>;
<span class="keyword">import</span> <span class="include">io.vertx.rxjava.ext.auth.shiro.ShiroAuth</span>;
<span class="keyword">import</span> <span class="include">io.vertx.rxjava.ext.web.Router</span>;
<span class="keyword">import</span> <span class="include">io.vertx.rxjava.ext.web.RoutingContext</span>;
<span class="keyword">import</span> <span class="include">io.vertx.rxjava.ext.web.client.WebClient</span>;
<span class="keyword">import</span> <span class="include">io.vertx.rxjava.ext.web.client.HttpResponse</span>; <b class="conum">(1)</b>
<span class="keyword">import</span> <span class="include">io.vertx.rxjava.ext.web.codec.BodyCodec</span>;
<span class="keyword">import</span> <span class="include">io.vertx.rxjava.ext.web.handler</span>.*;
<span class="keyword">import</span> <span class="include">io.vertx.rxjava.ext.web.sstore.LocalSessionStore</span>;
<span class="keyword">import</span> <span class="include">io.vertx.rxjava.ext.web.templ.FreeMarkerTemplateEngine</span>;
<span class="keyword">import</span> <span class="include">org.slf4j.Logger</span>;
<span class="keyword">import</span> <span class="include">org.slf4j.LoggerFactory</span>;
<span class="keyword">import</span> <span class="include">rx.Observable</span>;
<span class="keyword">import</span> <span class="include">rx.Single</span>;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Our <code>backupHandler()</code> method still uses <code>HttpResponse</code> class, so it must be imported. It turns out that the RxJava
version of <code>HttpResponse</code> provided by Vert.x can serve as a drop-in replacement in this specific case.
The <em>"Rxified"</em> code in <code>step-8</code> folder of the guide repository does not import this class as the
response type is inferred by the lambda expression.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_use_delegate_on_a_em_rxified_em_code_vertx_code_instance">Use delegate on a <em>"Rxified"</em> <code>vertx</code> instance</h3>
<div class="paragraph">
<p>To call a method expecting a <code>io.vertx.core.Vertx</code> instance when you have a <code>io.vertx.rxjava.core.Vertx</code> one, call
the <code>getDelegate()</code> method. Verticle&#8217;s <code>start()</code> method needs to be adjusted when creating an instance of
<code>WikiDatabaseService</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> start(<span class="predefined-type">Future</span>&lt;<span class="predefined-type">Void</span>&gt; startFuture) <span class="directive">throws</span> <span class="exception">Exception</span> {

  <span class="predefined-type">String</span> wikiDbQueue = config().getString(CONFIG_WIKIDB_QUEUE, <span class="string"><span class="delimiter">&quot;</span><span class="content">wikidb.queue</span><span class="delimiter">&quot;</span></span>);
  dbService = io.vertx.guides.wiki.database.WikiDatabaseService.createProxy(vertx.getDelegate(), wikiDbQueue);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_executing_authorization_queries_concurrently">Executing authorization queries concurrently</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous example, we saw how to use RxJava operators and the Rxified Vert.x API to execute asynchronous operations in order.
But sometimes this guarantee is not required, or you simply want them to run concurrently for performance reasons.</p>
</div>
<div class="paragraph">
<p>The JWT token generation process in the <code>HttpServerVerticle</code> is a good example of such a situation.
To create a token, we need all authorization query results to complete, but queries are independent from each other:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">auth.rxAuthenticate(creds).flatMap(user -&gt; {
  Single&lt;<span class="predefined-type">Boolean</span>&gt; create = user.rxIsAuthorised(<span class="string"><span class="delimiter">&quot;</span><span class="content">create</span><span class="delimiter">&quot;</span></span>); <b class="conum">(1)</b>
  Single&lt;<span class="predefined-type">Boolean</span>&gt; delete = user.rxIsAuthorised(<span class="string"><span class="delimiter">&quot;</span><span class="content">delete</span><span class="delimiter">&quot;</span></span>);
  Single&lt;<span class="predefined-type">Boolean</span>&gt; update = user.rxIsAuthorised(<span class="string"><span class="delimiter">&quot;</span><span class="content">update</span><span class="delimiter">&quot;</span></span>);

  <span class="keyword">return</span> Single.zip(create, delete, update, (canCreate, canDelete, canUpdate) -&gt; { <b class="conum">(2)</b>
    <span class="keyword">return</span> jwtAuth.generateToken(
      <span class="keyword">new</span> JsonObject()
        .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>, context.request().getHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">login</span><span class="delimiter">&quot;</span></span>))
        .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">canCreate</span><span class="delimiter">&quot;</span></span>, canCreate)
        .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">canDelete</span><span class="delimiter">&quot;</span></span>, canDelete)
        .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">canUpdate</span><span class="delimiter">&quot;</span></span>, canUpdate),
      <span class="keyword">new</span> JWTOptions()
        .setSubject(<span class="string"><span class="delimiter">&quot;</span><span class="content">Wiki API</span><span class="delimiter">&quot;</span></span>)
        .setIssuer(<span class="string"><span class="delimiter">&quot;</span><span class="content">Vert.x</span><span class="delimiter">&quot;</span></span>));
  });
}).subscribe(token -&gt; {
  context.response().putHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>).end(token);
}, t -&gt; context.fail(<span class="integer">401</span>));</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Three <code>Single</code> objects are created, representing the different authorization queries.</p>
</li>
<li>
<p>When the three operations complete successfully, the <code>zip</code> operator callback is invoked with the results.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_working_with_database_connections">Working with database connections</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To acquire a database connection from the pool, all you have to do is calling <code>rxGetConnection</code> on the <code>JDBCClient</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Single&lt;SQLConnection&gt; connection = dbClient.rxGetConnection();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method returns a <code>Single&lt;Connection&gt;</code> which you can easily transform with <code>flatMap</code> to execute SQL queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Single&lt;<span class="predefined-type">ResultSet</span>&gt; resultSet = dbClient.rxQueryWithParams(
  sqlQueries.get(SqlQuery.GET_PAGE_BY_ID), <span class="keyword">new</span> JsonArray().add(id));</code></pre>
</div>
</div>
<div class="paragraph">
<p>But how can we release the connection if the <code>SQLConnection</code> reference is no longer reachable?
A simple and convenient way to do this is to invoke <code>close</code> when the <code>Single&lt;SQLConnection&gt;</code> is unsubscribed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> Single&lt;SQLConnection&gt; getConnection() {
  <span class="keyword">return</span> dbClient.rxGetConnection().flatMap(conn -&gt; {
    Single&lt;SQLConnection&gt; connectionSingle = Single.just(conn); <b class="conum">(1)</b>
    <span class="keyword">return</span> connectionSingle.doOnUnsubscribe(conn::close); <b class="conum">(2)</b>
  });
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>After the connection is acquired we wrap it into a <code>Single</code></p>
</li>
<li>
<p>The <code>Single</code> is modified to invoke <code>close</code> when unsubscribed</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now we shall use <code>getConnection</code> anytime we need to execute SQL queries in our database verticle.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bridging_the_gap_between_callbacks_and_rxjava">Bridging the gap between callbacks and RxJava</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At times, you may have to mix your RxJava code with a callback-based API.
For example, service proxy interfaces can only be defined with callbacks, but the implementation uses the Vert.x Rxified API.</p>
</div>
<div class="paragraph">
<p>In this case, the <code>io.vertx.rx.java.RxHelper</code> class can adapt a <code>Handler&lt;AsyncResult&lt;T&gt;&gt;</code> to an RxJava <code>Subscriber&lt;T&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> WikiDatabaseService fetchAllPagesData(<span class="predefined-type">Handler</span>&lt;AsyncResult&lt;<span class="predefined-type">List</span>&lt;JsonObject&gt;&gt;&gt; resultHandler) { <b class="conum">(1)</b>
  dbClient.rxQuery(sqlQueries.get(SqlQuery.ALL_PAGES_DATA))
    .map(<span class="predefined-type">ResultSet</span>::getRows)
    .subscribe(RxHelper.toSubscriber(resultHandler));  <b class="conum">(2)</b>
  <span class="keyword">return</span> <span class="local-variable">this</span>;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>fetchAllPagesData</code> is an asynchronous service proxy operation, defined with a <code>Handler&lt;AsyncResult&lt;List&lt;JsonObject&gt;&gt;&gt;</code> callback.</p>
</li>
<li>
<p>The <code>toSubscriber</code> method adapts the <code>resultHandler</code> to a <code>Subscriber&lt;List&lt;JsonObject&gt;&gt;</code>, so that the handler is invoked when the list of rows is emitted.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_flows">Data flows</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RxJava is not only great at combining different sources of events, it is also very helpful with data flows.
Unlike a Vert.x or JDK future, an <code>Observable</code> emits a stream of events, not just a single one.
And it comes with an extensive set of data manipulation operators.</p>
</div>
<div class="paragraph">
<p>We can use a few of them to refactor the <code>fetchAllPages</code> database verticle method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> WikiDatabaseService fetchAllPages(<span class="predefined-type">Handler</span>&lt;AsyncResult&lt;JsonArray&gt;&gt; resultHandler) {
  dbClient.rxQuery(sqlQueries.get(SqlQuery.ALL_PAGES))
    .flatMapObservable(res -&gt; {  <b class="conum">(1)</b>
      <span class="predefined-type">List</span>&lt;JsonArray&gt; results = res.getResults();
      <span class="keyword">return</span> <span class="predefined-type">Observable</span>.from(results); <b class="conum">(2)</b>
    })
    .map(json -&gt; json.getString(<span class="integer">0</span>)) <b class="conum">(3)</b>
    .sorted() <b class="conum">(4)</b>
    .collect(JsonArray::<span class="keyword">new</span>, JsonArray::add) <b class="conum">(5)</b>
    .subscribe(RxHelper.toSubscriber(resultHandler));
  <span class="keyword">return</span> <span class="local-variable">this</span>;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>With <code>flatMapObservable</code> we will create an <code>Observable</code> from the item emitted by the <code>Single&lt;Result&gt;</code>.</p>
</li>
<li>
<p><code>from</code> converts the database <code>results</code> iterable into an <code>Observable</code> emitting the database row items.</p>
</li>
<li>
<p>Since we only need the page name we can <code>map</code> each <code>JsonObject</code> row to the first column.</p>
</li>
<li>
<p>The client expects the data to be <code>sorted</code> in alphabetical order.</p>
</li>
<li>
<p>The event bus service reply consists in a single <code>JsonArray</code>. <code>collect</code> creates a new one with <code>JsonArray::new</code> and later adds items as they are emitted with <code>JsonArray::add</code>.</p>
</li>
</ol>
</div>
</div>
</div>

        

        
          <div id="footer">
            <div id="footer-text">
              
                Last updated 2017-10-19 14:01:10 CEST
              
              
            </div>
          </div>
        
      </div>
    </div>
  </div>
</div>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-xs-4 col-sm-4 col-md-2 col-lg-2">
        <h2>Eclipse Vert.x</h2>
        <ul class="list-unstyled">
          <li><a href="http://vertx.io/">Home</a></li>
          <li><a href="http://vertx.io/download/">Download</a></li>
          <li><a href="http://vertx.io/docs/3.5.0/">Documentation</a></li>
          <li><a href="https://github.com/vert-x3/wiki/wiki">Wiki</a></li>
          <li><a href="http://vertx.io/blog/">Blog</a></li>
          <li><a href="http://vertx.io/vertx2/" class="vertx-2-link">Vert.x 2</a></li>
        </ul>
      </div>
      <div class="col-xs-4 col-sm-4 col-md-2 col-lg-2">
        <h2>Community</h2>
        <ul class="list-unstyled">
          <li><a href="http://vertx.io/community/">Help &amp; Contributors</a></li>
          <li><a href="http://vertx.io/materials/">Learning materials</a></li>
          <li><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx">User Group</a></li>
          <li><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx-dev">Developer Group</a></li>
        </ul>
      </div>
      <div class="col-xs-4 col-sm-4 col-md-2 col-lg-2">
        <h2>Eclipse</h2>
        <ul class="list-unstyled">
          <li><a href="http://www.eclipse.org/">Eclipse Foundation</a></li>
          <li><a href="https://eclipse.org/legal/privacy.php">Privacy Policy</a></li>
          <li><a href="https://eclipse.org/legal/termsofuse.php">Terms of Use</a></li>
          <li><a href="https://eclipse.org/legal/copyright.php">Copyright Agent</a></li>
          <li><a href="http://www.eclipse.org/legal">Legal Resources</a></li>
        </ul>
      </div>

      <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 copyright">
        <p>Eclipse Vert.x is open source and dual licensed under the <a href="https://www.eclipse.org/org/documents/epl-v10.php">Eclipse Public License 1.0</a> and <a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache License 2.0</a>.</p>
        <p>This website is licensed under the <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0 License</a>.<br>
        Design by <a href="https://www.michel-kraemer.com">Michel Kr&auml;mer</a>.</p>
        <div class="row">
          <div class="col-sm-12 col-md-5 col-md-offset-1 col-lg-offset-2">
            <a href="http://eclipse.org">
            <img class="logo eclipse-logo" src="http://vertx.io/assets/eclipse_logo_grey_small.png" width="204" height="48">
            </a>
          </div>
          <div class="col-sm-12 col-md-5 col-md-offset-1 col-lg-offset-0">
            <a href="http://cloudbees.com">
            <img class="logo cloudbees-logo" src="http://vertx.io/assets/Button-Built-on-CB-1-grey.png" width="180" height="48">
           </a>
          </div>
          <div class="col-sm-12 col-md-5 col-md-offset-7 jprofiler">
            <a href="http://www.ej-technologies.com/products/jprofiler/overview.html"
            style="text-decoration:none">
            <img class="logo jprofiler-logo" src="http://vertx.io/assets/jprofiler-logo.png" width="48" height="48"><span class="jprofiler-logo">&nbsp; JPROFILER</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="http://static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script>
<script src="http://vertx.io/javascripts/bootstrap.min.js"></script>
<script src="http://vertx.io/javascripts/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



<script src="http://vertx.io/javascripts/sidebar.js"></script>


</body>
</html>

