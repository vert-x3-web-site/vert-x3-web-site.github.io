<!DOCTYPE html><html lang=en><head><title>Eclipse Vert.x based Framework URL Shortener Backend</title><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta content="width=device-width,initial-scale=1" name=viewport><meta content="Eclipse Vert.x is a tool-kit for building reactive applications on the JVM." name=description><link href=https://vertx.io/preview/stylesheets/main.css media=screen rel=stylesheet><link href=https://vertx.io/preview/stylesheets/font-awesome.min.css media=screen rel=stylesheet><link href=https://vertx.io/preview/javascripts/styles/rainbow.min.css media=screen rel=stylesheet><!--[if lt IE 9]><script src="http://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script><![endif]--><link rel=apple-touch-icon sizes=57x57 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-180x180.png><link rel=icon type=image/png href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/favicon-16x16.png sizes=16x16><link rel=manifest href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/manifest.json><link rel=mask-icon href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content=#7d3194><meta name=msapplication-TileImage content=https://vertx.io/preview/assets/favicons/vertx-favicon-7/mstile-144x144.png><meta name=theme-color content=#ffffff><link href="https://fonts.googleapis.com/css?family=Ubuntu:400,500,700,400italic" rel=stylesheet type=text/css><link rel=alternate type=application/rss+xml title=RSS href=https://vertx.io/preview/feed.xml><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-30144458-1', 'auto');
    ga('create', 'UA-71153120-1', 'auto', 'tracker');
    ga('send', 'pageview');
    ga('tracker.send', 'pageview');</script></head><body><a href="http://www.reactivemanifesto.org/" id=reactive-manifesto-banner><img style="border: 0; position: fixed; right: 0; top:0; z-index: 9000" src=https://d379ifj7s9wntv.cloudfront.net/reactivemanifesto/images/ribbons/we-are-reactive-black-right.png></a> <a id=skippy class="sr-only sr-only-focusable" href=#content><div class=container><span class=skiplink-text>Skip to main content</span></div></a><header class="navbar navbar-default navbar-static-top" id=top role=banner><div class=container><div class=navbar-header><button class="navbar-toggle collapsed" type=button data-toggle=collapse data-target=#vertx-navbar-collapse><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="https://vertx.io/preview/" class=navbar-brand><img alt=Brand src=https://vertx.io/preview/assets/logo-sm.png></a></div><nav class="collapse navbar-collapse" id=vertx-navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=http://start.vertx.io>Starter</a></li><li><a href="https://vertx.io/preview/download/">Download</a></li><li><a href="https://vertx.io/preview/docs/">Documentation</a></li><li><a href=https://github.com/vert-x3/wiki/wiki>Wiki</a></li><li><a href="https://vertx.io/preview/community/">Community</a></li><li><a href="https://vertx.io/preview/materials/">Materials</a></li><li><a href="https://vertx.io/preview/blog/">Blog</a></li></ul></nav></div></header><div class=container><div class="row blog"><article class="col-xs-12 blog-post"><h2 class=blog-post-title>Eclipse Vert.x based Framework URL Shortener Backend</h2><p class=blog-post-meta>21st December 2017 by <a href=http://github.com/pendula95>pendula95</a></p><article><h2 id=aws-lambda-vertx-framework-url-shortener-backend>AWS Lambda &amp; Vertx Framework URL Shortener Backend</h2><h3 id=intro>Intro</h3><p>Recently I stumbled upon <a href="http://vertx.io/"><strong>Vertx</strong></a>. <strong>Event-driven, asynchronized, lightweight, reactive, highly performant, polyglot</strong> application framework. Ideal for writing <strong>micro-services</strong>. I played around with it for a while and really enjoyed the concept of <strong>serverless</strong> applications.</p><p>I developed a few apps and cases and started to wonder how to run and deploy them so that I get a 100% reliable service. I suddenly remembered the tech seminar that I attended recently, specifically session about serverless apps with <a href="https://aws.amazon.com/"><strong>AWS</strong></a> (Amazon Web Services) <strong>Lambda</strong>. Lambda is a serverless compute service that runs your code in response to events and automatically manages the underlying compute resources for you. Fairly similar concepts <strong>Vertx</strong> and <strong>AWS Lambda</strong>, so maybe they complement each other? As it turns out they do, <strong>Vertx</strong> can get most of your <strong>Lambdas</strong>â€¦</p><p>Using the <a href="https://serverless.com/"><strong>Serverless Framework</strong></a> to create, manage and deploy your new <strong>Lambdas</strong> I was able to get this <strong>micro-service</strong> up and running in no time.</p><p><em>Enough with the talk, lets see the implementation.</em></p><h3 id=code>Code</h3><p><em>Handler Class, entry point of AWS Request.</em></p><p>The first issue that I had was the <strong>sync</strong> Event Handler that is provided by AWS. So I had to by pass it with Future. In the Handler class I first initiate Vertx instance in a static block and deploy few Verticles that will do the work. This class only receives the event, extracts needed data from the request and passes the data to Vertx EventBus. After the Consumers handle the request, Handler class will generate a proper response and finish the AWS request.</p><script src=https://gist.github.com/pendula95/583eb45bd0a7990136fba029bdcd555b.js></script><p><em>Line 4-18:</em> This is where Vertx instance is created, Verticles are deployed and <strong>Async JDBC</strong> client is created. I figured out that it is better to created JDBC client here as in some cases I was timeout when that logic was in the Verticle start method.</p><p><em>Line 27-36:</em> These are helper lines, parsing and formatting the data so I can pass it to the Verticles.</p><p><em>Line 38-45:</em> I have decided to map the consumers to the address that is made of request method and url path, example POST/api. This means each API request is mapped to its own consumer in Verticle class.</p><p><em>Line 47-77:</em> This is nothing but a block of code that handles the response that was passed from Verticles to the Future and generates the final response that will be return to API Gateway.</p><p><em>UrlService, Vertx Verticle.</em></p><p>Verticle class is pretty forward. Consumers that will process the message, methods for working with JDBC and helper methods for hashing/dehashing id. The logic behind url shortening is fairly simple here. Each long url is stored in database with a unique id and few additional columns. Row id is hashed and returned as short url. When retrieving long url hash is decoded to row id and long url is retrieved. Later user is redirected to long url. With this implementation, on 6 char short url (characters after the domain) you get 62^6 combinations which is 56 800 235 584 rows for storing your urls. TinyURL is currently at 6 long char urls (characters after domain). You can of course implement methods for reusing and recycling ids.</p><script src=https://gist.github.com/pendula95/aeb4479162e6e33504add2af9fa68bc5.js></script><p>As said, this is all fairly straight forward, if you are already familiar with <strong>Vertx</strong>. If you are thinking why have I repeated the code for establish a <strong>JDBC</strong> connection, here is the explanation <em>(line: 10-16)</em>. I was getting Timeouts when creating JDBC connection in Verticles. To avoid this I also added this code to my Handler class. This way connection is created there and because of the <strong>Vertx</strong> implementation any later attempt to create it again will result in just getting the instances from the first invocation. This escaped the need to pass the instances directly from the Handler class when creating Verticle instances.</p><p><em>Serverless configuration.</em></p><p>Lastly I would like to share the serverless.yml, confirmation file that allows seamlessly deploy and management of AWS Lambda. With just a few commands and lines of configuration you are able to configure all necessary steps for deploying your AWS Lambda. Framework takes care of making configuration of Api-Gateway and other AWS hassle that would otherwise needed to be done by hand. In this case Lambda is invoked by HTTP events.</p><script src=https://gist.github.com/pendula95/33adc47265072ed930c7df98c9ace7be.js></script><h3 id=performance-and-tests>Performance and Tests</h3><p><strong>Vertx</strong> async capabilities eased the stress and memory needs of traditional <strong>AWS Lambdas</strong> with sync methods. After performing load tests Lambdas that were written using Vertx framework preformed <strong>10% faster and consumed 40% less memory</strong>. As I have read somewhere in Vertx documentation, Sync methods will definitely finish the first request faster but in total Async will be faster in the end. This savings in memory and time will definitely reduce the cost of running your Lambdas and the little overhead with additional code is for sure worth it.</p><h3 id=conclusion>Conclusion</h3><p>To follow the pace of demanding needs for fast and resilient services we need to move from traditional Monoliths. Embracing the <strong>micro service</strong> architecture alone will not cut it, not anymore. With the rise and rapid advancement of <strong>Cloud</strong> solutions it has never been so easy to make a truly <strong>Serverless</strong> systems build upon network of <strong>micro services</strong>. As you have seen <strong>Vertx</strong> with its async API makes the full advantage of <strong>AWS Lambdas</strong>, embracing them while also improving the performance and lowering the costs. With the help from <strong>Serverless Framework</strong> writing, deploying and managing your <strong>Lambdas</strong> has never been so easy.</p><p>If you are interested in the whole project, you can find it on <a href=https://github.com/pendula95/vertx-aws-url-shortener-service/tree/master><strong>GitHub</strong></a>.</p><p><div class="admonition-block info"><table><tbody><tr><td class=admonition-icon><i class="admonition-icon fa fa-info-circle"></i></td><td class=content><span class=title>Info</span><br><span class=content>this is a re-publication of the following <a href="http://lazarbulic.com/blog/2017/11/10/aws-lambda-vertx-framework-url-shortener-backend/">blog post</a></span></td></tr></tbody></table></div></p></article></article></div><div class=row><div class=col-xs-12 id=disqus_thread></div></div><script>var disqus_config = function () {
  this.page.url = "https://vertx.io/preview/blog/eclipse-vert-x-based-framework-url-shortener-backend/";
  this.page.identifier = "/blog/eclipse-vert-x-based-framework-url-shortener-backend/";
  };
  (function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://vertx.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><footer><div class=container><div class=row><div class="col-xs-4 col-sm-4 col-md-2 col-lg-2"><h2>Eclipse Vert.x</h2><ul class=list-unstyled><li><a href="https://vertx.io/preview/">Home</a></li><li><a href="https://vertx.io/preview/download/">Download</a></li><li><a href="https://vertx.io/preview/docs/">Documentation</a></li><li><a href=https://github.com/vert-x3/wiki/wiki>Wiki</a></li><li><a href="https://vertx.io/preview/blog/">Blog</a></li><li><a href="https://vertx.io/preview/vertx2/" class=vertx-2-link>Vert.x 2</a></li></ul></div><div class="col-xs-4 col-sm-4 col-md-2 col-lg-2"><h2>Community</h2><ul class=list-unstyled><li><a href="https://vertx.io/preview/community/">Help &amp; Contributors</a></li><li><a href="https://vertx.io/preview/materials/">Learning materials</a></li><li><a href=https://groups.google.com/forum/?fromgroups#!forum/vertx>User Group</a></li><li><a href=https://groups.google.com/forum/?fromgroups#!forum/vertx-dev>Developer Group</a></li></ul></div><div class="col-xs-4 col-sm-4 col-md-2 col-lg-2"><h2>Eclipse</h2><ul class=list-unstyled><li><a href="http://www.eclipse.org/">Eclipse Foundation</a></li><li><a href=https://eclipse.org/legal/privacy.php>Privacy Policy</a></li><li><a href=https://eclipse.org/legal/termsofuse.php>Terms of Use</a></li><li><a href=https://eclipse.org/legal/copyright.php>Copyright Agent</a></li><li><a href=http://www.eclipse.org/legal>Legal Resources</a></li></ul></div><div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 copyright"><p>Eclipse Vert.x is open source and dual-licensed under the <a href=http://www.eclipse.org/legal/epl-v20.html>Eclipse Public License 2.0</a> and <a href=https://www.apache.org/licenses/LICENSE-2.0.html>Apache License 2.0</a>.</p><p>This website is licensed under the <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0 License</a>.<br>Design by <a href=https://www.michel-kraemer.com>Michel Kr&auml;mer</a>.</p><div class=row><div class="col-sm-12 col-md-5 col-md-offset-1 col-lg-offset-2"><a href=http://eclipse.org><img class="logo eclipse-logo" src=https://vertx.io/preview/assets/eclipse_logo_grey_small.png width=204 height=48></a></div><div class="col-sm-12 col-md-5 col-md-offset-1 col-lg-offset-0"><a href=http://cloudbees.com><img class="logo cloudbees-logo" src=https://vertx.io/preview/assets/Button-Built-on-CB-1-grey.png width=180 height=48></a></div><div class="col-sm-12 col-md-5 col-md-offset-7 jprofiler"><a href=http://www.ej-technologies.com/products/jprofiler/overview.html style=text-decoration:none><img class="logo jprofiler-logo" src=https://vertx.io/preview/assets/jprofiler-logo.png width=48 height=48><span class=jprofiler-logo>&nbsp; JPROFILER</span></a></div></div></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js></script><script src=https://vertx.io/preview/javascripts/bootstrap.min.js></script><script src=https://vertx.io/preview/javascripts/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>