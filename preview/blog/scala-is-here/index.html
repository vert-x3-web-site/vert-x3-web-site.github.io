<!DOCTYPE html><html lang=en><head><title>Scala is here</title><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta content="width=device-width,initial-scale=1" name=viewport><meta content="Eclipse Vert.x is a tool-kit for building reactive applications on the JVM." name=description><link href=https://vertx.io/preview/stylesheets/main.css media=screen rel=stylesheet><link href=https://vertx.io/preview/stylesheets/font-awesome.min.css media=screen rel=stylesheet><link href=https://vertx.io/preview/javascripts/styles/rainbow.min.css media=screen rel=stylesheet><!--[if lt IE 9]><script src="http://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script><![endif]--><link rel=apple-touch-icon sizes=57x57 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-180x180.png><link rel=icon type=image/png href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/favicon-16x16.png sizes=16x16><link rel=manifest href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/manifest.json><link rel=mask-icon href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content=#7d3194><meta name=msapplication-TileImage content=https://vertx.io/preview/assets/favicons/vertx-favicon-7/mstile-144x144.png><meta name=theme-color content=#ffffff><link href="https://fonts.googleapis.com/css?family=Ubuntu:400,500,700,400italic" rel=stylesheet type=text/css><link rel=alternate type=application/rss+xml title=RSS href=https://vertx.io/preview/feed.xml><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-30144458-1', 'auto');
    ga('create', 'UA-71153120-1', 'auto', 'tracker');
    ga('send', 'pageview');
    ga('tracker.send', 'pageview');</script></head><body><a href="http://www.reactivemanifesto.org/" id=reactive-manifesto-banner><img style="border: 0; position: fixed; right: 0; top:0; z-index: 9000" src=https://d379ifj7s9wntv.cloudfront.net/reactivemanifesto/images/ribbons/we-are-reactive-black-right.png></a> <a id=skippy class="sr-only sr-only-focusable" href=#content><div class=container><span class=skiplink-text>Skip to main content</span></div></a><header class="navbar navbar-default navbar-static-top" id=top role=banner><div class=container><div class=navbar-header><button class="navbar-toggle collapsed" type=button data-toggle=collapse data-target=#vertx-navbar-collapse><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="https://vertx.io/preview/" class=navbar-brand><img alt=Brand src=https://vertx.io/preview/assets/logo-sm.png></a></div><nav class="collapse navbar-collapse" id=vertx-navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=http://start.vertx.io>Starter</a></li><li><a href="https://vertx.io/preview/download/">Download</a></li><li><a href="https://vertx.io/preview/docs/">Documentation</a></li><li><a href=https://github.com/vert-x3/wiki/wiki>Wiki</a></li><li><a href="https://vertx.io/preview/community/">Community</a></li><li><a href="https://vertx.io/preview/materials/">Materials</a></li><li><a href="https://vertx.io/preview/blog/">Blog</a></li></ul></nav></div></header><div class=container><div class="row blog"><article class="col-xs-12 blog-post"><h2 class=blog-post-title>Scala is here</h2><p class=blog-post-meta>20th March 2017 by <a href=http://github.com/codepitbull>codepitbull</a></p><article><h2 id=tl-dr>TL;DR</h2><ul><li>Scala support for Vert.x is here!</li><li>It is based on Scala 2.12, no support for 2.11 planned</li><li>all Vert.x-modules are available in a Scala flavor</li><li>It’s awesome</li><li>Get started <a href=https://github.com/vert-x3/vertx-sbt-starter>here</a></li></ul><h2 id=intro>Intro</h2><p>The rise of <a href="http://scala-lang.org/">Scala</a> as one of the most important languages on the JVM caught many (me included) by surprise. This hybrid of functional and imperative paradigms struck a chord with many developers. Thanks to Scala a lot of people who’d never have touched a language like Haskell got exposed to functional programming. This exposure was one of the driving forces to get streams and lambda into the JVM.</p><p>With the release of Vert.x 3.4.0 we finally introduced Scala to the family of supported languages: <a href=https://github.com/vert-x3/vertx-lang-scala>vertx-lang-scala</a>.</p><p>In this post I will introduce the new stack and how the power of Scala can be used in your favorite reactive toolkit.</p><h2 id=basics>Basics</h2><p>vertx-lang-scala is based on Scala 2.12. There are no plans to support 2.11.</p><p>All modules available for Vert.x are supported (you can check <a href=https://github.com/vert-x3/vertx-lang-scala/tree/master/vertx-lang-scala-stack>here</a> ).</p><p><div class="admonition-block note"><table><tbody><tr><td class=admonition-icon><i class="admonition-icon fa fa-comment"></i></td><td class=content><span class=title>Future and Promise both need a ExecutionContext</span><br><span class=content>Modules use the following naming-scheme: <em>io.vertx:&lt;name-of-vertx-module&gt;-scala_2.12:&lt;vertx-major-version&gt;</em>. The Scala version of <em>io.vertx:vert-web:3.4.0</em> would be <em>io.vertx:vertx-web-scala_2.12:3.4.0</em>.</span></td></tr></tbody></table></div></p><p>There is an sbt-based <a href=https://github.com/vert-x3/vertx-sbt-starter>quickstart-project</a> available that will be updated for each Vert.x-release.</p><p>Please note: Although <a href="http://www.scala-sbt.org/">sbt</a> is used in this quickstart it is by no means required. There are no special plugins involved so vertx-lang-scala can easily be used with <a href=https://docs.gradle.org/current/userguide/scala_plugin.html>Gradle</a> or <a href=https://github.com/davidB/scala-maven-plugin>Maven</a>.</p><p>I use sbt as it is the default build system used for Scala projects.</p><h2 id=quickstart>Quickstart</h2><p>Let’s get started by cloning the quickstart:</p><pre><code class="hljs bash">git clone git@github.com:vert-x3/vertx-sbt-starter.git</code></pre><p>You just got the following things:</p><ul><li>An sbt project containing dependencies to Vert.x-core and Vert.x-web</li><li>The ability to create a fat-jat via <code>sbt assembly</code></li><li>The ability to create a docker container via <code>sbt docker</code></li><li>A few example verticles</li><li>Unit test examples</li><li>a pre-configured Scala-shell inside sbt</li></ul><p>We will now run the application to get some quick satisfaction. Use <code>sbt assembly</code> to produce the fat-jar followed by <code>java -jar target/scala-2.12/vertx-scala-sbt-assembly-0.1-SNAPSHOT.jar</code>. Now point your browser to <a href=http://localhost:8666/hello>http://localhost:8666/hello</a> for a classic welcome message.</p><h2 id=the-details>The details</h2><p>Open your IDE so we can take a look at what’s going on under the hood. We start with the <em>HttpVerticle</em>.</p><pre><code class=hljs><span class=hljs-keyword>package</span> io.vertx.scala.sbt

<span class=hljs-keyword>import</span> io.vertx.lang.scala.<span class=hljs-type>ScalaVerticle</span>
<span class=hljs-keyword>import</span> io.vertx.scala.ext.web.<span class=hljs-type>Router</span>

<span class=hljs-keyword>import</span> scala.concurrent.<span class=hljs-type>Future</span>

<span class=hljs-class><span class=hljs-keyword>class</span> <span class=hljs-title>HttpVerticle</span> <span class=hljs-keyword><span class=hljs-keyword>extends</span></span> <span class=hljs-title>ScalaVerticle</span> {</span> <span class=hljs-comment>// &lt;1&gt;</span>


  <span class=hljs-keyword>override</span> <span class=hljs-function><span class=hljs-keyword>def</span> <span class=hljs-title>startFuture</span>(</span>): <span class=hljs-type>Future</span>[<span class=hljs-type>Unit</span>] = { <span class=hljs-comment>// &lt;2&gt;</span>
    <span class=hljs-function><span class=hljs-keyword>val</span> <span class=hljs-title>router</span> =</span> <span class=hljs-type>Router</span>.router(vertx) <span class=hljs-comment>// &lt;3&gt;</span>
    <span class=hljs-function><span class=hljs-keyword>val</span> <span class=hljs-title>route</span> =</span> router
      .get(<span class=hljs-string>"/hello"</span>)
        .handler(_.response().end(<span class=hljs-string>"world"</span>))

    vertx <span class=hljs-comment>//&lt;4&gt;</span>
      .createHttpServer()
      .requestHandler(router.accept)
      .listenFuture(<span class=hljs-number>8666</span>, <span class=hljs-string>"0.0.0.0"</span>)  <span class=hljs-comment>// &lt;5&gt;</span>
        .map(_ =&gt; ()) <span class=hljs-comment>// &lt;6&gt;</span>
  }
}</code></pre><ol><li><em>ScalaVerticle</em> is the base class for all Scala-Verticles. It provides all required methods to integrate with the Vert.x-runtime.</li><li>There are two ways to start a Verticle. Overriding <em>startFuture</em>, like in this example, tells Vert.x to only consider the Verticle fully started after the returned <em>Future[Unit]</em> has been successfully completed. Alternatively one can override <em>start</em> and by that signal to Vert.x the instant availability of the Verticle.</li><li>This block creates a <em>Router</em> for incoming HTTP-requests. It registers a handler to answer with “world” if a request to the URL “/hello” arrives. The class is coming from the <a href="http://vertx.io/docs/vertx-web/scala/">Vert.x-web-module</a>.</li><li>Every Verticle has access to the Vert.x-instance. Here we use it to create a webserver and register our router to handle incoming requests.</li><li>We finally reached the reason why I use <em>startFuture</em> in the first place. All operations in Vert.x are asynchronous. So starting the webserver most definitely means it takes some more time until it bound to the given port (8666 in this case). That’s why <em>listenFuture</em> is used, which returns a <em>Future</em> which in turn contains the actual instance of the webserver that just got started. So our Verticle will be ready to receive requests <em>after</em> the returned <em>Future</em> has been completed.</li><li>In most cases we can return the <em>Future</em> directly. In this case the <em>Future</em> returned by <em>listenFuture</em> has the wrong type. We get a <em>Future[HttpServer]</em> but we need a <em>Future[Unit]</em> as you can see in the signature of <em>startFuture</em>. This call takes care of mapping the given <em>Future[HttpServer]</em> to the required return type.</li></ol><h2 id=testing>Testing</h2><p>I use <a href="http://www.scalatest.org/">ScalaTest</a> for all my testing needs. It comes with stellar support for asynchronous operations and is a perfect fit for testing Vert.x-applications.</p><p>The following <em>HttpVerticleSpec</em> shows how to test an HTTP-API using only Vert.x-classes. Personally I prefer <a href="http://rest-assured.io/">REST-assured</a> with its rich DSL. For this post I wanted to stick with Vert.x-API, so here we go.</p><pre><code class="hljs scala"><span class=hljs-keyword>package</span> io.vertx.scala.sbt

<span class=hljs-keyword>import</span> org.scalatest.<span class=hljs-type>Matchers</span>

<span class=hljs-keyword>import</span> scala.concurrent.<span class=hljs-type>Promise</span>

<span class=hljs-class><span class=hljs-keyword>class</span> <span class=hljs-title>HttpVerticleSpec</span> <span class=hljs-keyword><span class=hljs-keyword>extends</span></span> <span class=hljs-title>VerticleTesting</span>[</span><span class=hljs-type>HttpVerticle</span>] <span class=hljs-keyword>with</span> <span class=hljs-type>Matchers</span> { <span class=hljs-comment>// &lt;1&gt;</span>

  <span class=hljs-string>"HttpVerticle"</span> should <span class=hljs-string>"bind to 8666 and answer with 'world'"</span> in { <span class=hljs-comment>// &lt;2&gt;</span>
    <span class=hljs-function><span class=hljs-keyword>val</span> <span class=hljs-title>promise</span> =</span> <span class=hljs-type>Promise</span>[<span class=hljs-type>String</span>] <span class=hljs-comment>// &lt;3&gt;</span>

    vertx.createHttpClient()  <span class=hljs-comment>// &lt;4&gt;</span>
      .getNow(<span class=hljs-number>8666</span>, <span class=hljs-string>"127.0.0.1"</span>, <span class=hljs-string>"/hello"</span>,
        r =&gt; {
          r.exceptionHandler(promise.failure)
          r.bodyHandler(b =&gt; promise.success(b.toString))
        })

    promise.future.map(res =&gt; res should equal(<span class=hljs-string>"world"</span>)) <span class=hljs-comment>// &lt;5&gt;</span>
  }

}</code></pre><ol><li><em>VerticleTesting</em> is a base class for your tests included with the quickstart-project. It’s a small helper that takes care of deploying/un-deploying the Verticle to be tested and manages a Vert.x-instance. It additionally extends <a href=http://www.scalatest.org/user_guide/async_testing>AsyncFlatSpec</a> so we can use Futures as test-return-types.</li><li>Isn’t it nice and readable?</li><li>The promise is required as the whole test will run async</li><li>We use the vertx-instance provided by <em>VerticleTesting</em> to create a Netty-based HttpClient. We instruct the client to call the specified URL and to succeed the <em>Promise</em> with the returned body.</li><li>This creates the actual assertion. After getting the <em>Future</em> from the <em>Promise</em> an assertion is created: <em>The Result should be equal to the String “world”</em>. ScalaTest takes care of evaluating the returned <em>Future</em>.</li></ol><p>That’s all you need to get started!</p><h2 id=futures-in-vertx-lang-scala>Futures in vertx-lang-scala</h2><p>Now for a more in depth topic I think is worth mentioning. vertx-lang-scala treats async operations the Scala-way which is a little different from what you might be used from Vert.x. For async operations like subscribing to the eventbus or deploying a Verticle you would call a method like this:</p><pre><code class="hljs scala">vertx.deployVerticle(<span class=hljs-string>"com.foo.OtherVerticle"</span>, res -&gt; {
  <span class=hljs-keyword>if</span> (res.succeeded()) {
    startFuture.complete();
  } <span class=hljs-keyword>else</span> {
    startFuture.fail(res.cause());
  }
});</code></pre><p>The <em>deployVerticle</em> method takes the Verticle-name and a <em>Handler[AsyncResult]</em> as its arguments. The <em>Handler[AsyncResult]</em> is called after Vert.x tried deploying the Verticle. This style can also be used for Scala (which might ease the transition when coming from the Java-world) but their is a way more <em>scalaish</em> way of doing this.</p><p>For every method taking a <em>Handler[AsyncResult]</em> as its argument I create an alternative method using <a href=http://docs.scala-lang.org/overviews/core/futures.html>Scala-Futures</a>.</p><pre><code class="hljs scala">vertx.deployVerticleFuture(<span class=hljs-string>"com.foo.OtherVerticle"</span>) <span class=hljs-comment>// &lt;1&gt;</span>
  .onComplete{  <span class=hljs-comment>// &lt;2&gt;</span>
    <span class=hljs-keyword>case</span> <span class=hljs-type>Success</span>(s) =&gt; println(s<span class=hljs-string>"Verticle id is: $s"</span>) <span class=hljs-comment>// &lt;3&gt;</span>
    <span class=hljs-keyword>case</span> <span class=hljs-type>Failure</span>(t) =&gt; t.printStackTrace()
  }</code></pre><ol><li>A method providing a <em>Future</em> based alternative gets <em>Future</em> appended to its name and returns a <em>Future</em> instead of taking a <em>Handler</em> as its argument.</li><li>We are now free to use <em>Future</em> the way we want. In this case onComplete is used to react on the completion.</li><li>Pattern matching on the result <em>&lt;3</em></li></ol><p>I strongly recommend using this approach over using <em>Handlers</em> as you won’t run into Callback-hell and you get all the goodies Scala provides for async operations.</p><p><div class="admonition-block note"><table><tbody><tr><td class=admonition-icon><i class="admonition-icon fa fa-comment"></i></td><td class=content><span class=title>Future and Promise both need a ExecutionContext</span><br><span class=content>The <a href=https://github.com/vert-x3/vertx-lang-scala/blob/master/vertx-lang-scala/src/main/scala/io/vertx/lang/scala/VertxExecutionContext.scala>VertxExecutionContext</a> is made implicitly available inside the <a href=https://github.com/vert-x3/vertx-lang-scala/blob/master/vertx-lang-scala/src/main/scala/io/vertx/lang/scala/ScalaVerticle.scala>ScalaVerticle</a>. It makes sure all operations are executed on the correct Event Loop. If you are using Vert.x without Verticles you have to provide it on your own.</span></td></tr></tbody></table></div></p><h2 id=using-the-console>Using the console</h2><p>A great feature of sbt is the embedded, configurable Scala-console. The console available in the quickstart-project is pre-configured to provide a fresh Vert.x-instance and all required imports so you can start playing around with Vert.x in an instant.</p><p>Execute the following commands in the project-folder to deploy the <em>HttpVerticle</em>:</p><pre><code class="hljs bash">sbt
&gt; console
scala&gt; vertx.deployVerticle(nameForVerticle[HttpVerticle])
scala&gt; vertx.deploymentIDs</code></pre><p>After executing this sequence you can now point your browser <a href=http://localhost:8666/hello>http://localhost:8666/hello</a> to see our message. The last command issued shows the Ids under which Verticles have been deployed.</p><p>To get rid of the deployment you can now type <code>vertx.undeploy(vertx.deploymentIDs.head)</code>.</p><h2 id=that-s-it->That’s it!</h2><p>This was a very quick introduction to our new Scala-stack. I hope to have given you a little taste of the Scala goodness now available with Vert.x. I recommend digging a little more through the quickstart to get a feeling for what’s there. In my next blog post I will explain some of the decisions I made and the obstacles I faced with the differences between Java and Scala /Hint: They are way bigger than I was aware of).</p><p>Enjoy!</p></article></article></div><div class=row><div class=col-xs-12 id=disqus_thread></div></div><script>var disqus_config = function () {
  this.page.url = "https://vertx.io/preview/blog/scala-is-here/";
  this.page.identifier = "/blog/scala-is-here/";
  };
  (function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://vertx.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><footer><div class=container><div class=row><div class="col-xs-4 col-sm-4 col-md-2 col-lg-2"><h2>Eclipse Vert.x</h2><ul class=list-unstyled><li><a href="https://vertx.io/preview/">Home</a></li><li><a href="https://vertx.io/preview/download/">Download</a></li><li><a href="https://vertx.io/preview/docs/">Documentation</a></li><li><a href=https://github.com/vert-x3/wiki/wiki>Wiki</a></li><li><a href="https://vertx.io/preview/blog/">Blog</a></li><li><a href="https://vertx.io/preview/vertx2/" class=vertx-2-link>Vert.x 2</a></li></ul></div><div class="col-xs-4 col-sm-4 col-md-2 col-lg-2"><h2>Community</h2><ul class=list-unstyled><li><a href="https://vertx.io/preview/community/">Help &amp; Contributors</a></li><li><a href="https://vertx.io/preview/materials/">Learning materials</a></li><li><a href=https://groups.google.com/forum/?fromgroups#!forum/vertx>User Group</a></li><li><a href=https://groups.google.com/forum/?fromgroups#!forum/vertx-dev>Developer Group</a></li></ul></div><div class="col-xs-4 col-sm-4 col-md-2 col-lg-2"><h2>Eclipse</h2><ul class=list-unstyled><li><a href="http://www.eclipse.org/">Eclipse Foundation</a></li><li><a href=https://eclipse.org/legal/privacy.php>Privacy Policy</a></li><li><a href=https://eclipse.org/legal/termsofuse.php>Terms of Use</a></li><li><a href=https://eclipse.org/legal/copyright.php>Copyright Agent</a></li><li><a href=http://www.eclipse.org/legal>Legal Resources</a></li></ul></div><div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 copyright"><p>Eclipse Vert.x is open source and dual-licensed under the <a href=http://www.eclipse.org/legal/epl-v20.html>Eclipse Public License 2.0</a> and <a href=https://www.apache.org/licenses/LICENSE-2.0.html>Apache License 2.0</a>.</p><p>This website is licensed under the <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0 License</a>.<br>Design by <a href=https://www.michel-kraemer.com>Michel Kr&auml;mer</a>.</p><div class=row><div class="col-sm-12 col-md-5 col-md-offset-1 col-lg-offset-2"><a href=http://eclipse.org><img class="logo eclipse-logo" src=https://vertx.io/preview/assets/eclipse_logo_grey_small.png width=204 height=48></a></div><div class="col-sm-12 col-md-5 col-md-offset-1 col-lg-offset-0"><a href=http://cloudbees.com><img class="logo cloudbees-logo" src=https://vertx.io/preview/assets/Button-Built-on-CB-1-grey.png width=180 height=48></a></div><div class="col-sm-12 col-md-5 col-md-offset-7 jprofiler"><a href=http://www.ej-technologies.com/products/jprofiler/overview.html style=text-decoration:none><img class="logo jprofiler-logo" src=https://vertx.io/preview/assets/jprofiler-logo.png width=48 height=48><span class=jprofiler-logo>&nbsp; JPROFILER</span></a></div></div></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js></script><script src=https://vertx.io/preview/javascripts/bootstrap.min.js></script><script src=https://vertx.io/preview/javascripts/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>