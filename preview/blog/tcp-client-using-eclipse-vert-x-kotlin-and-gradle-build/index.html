<!DOCTYPE html><html lang=en><head><title>TCP Client using Eclipse Vert.x, Kotlin and Gradle build</title><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta content="width=device-width,initial-scale=1" name=viewport><meta content="Eclipse Vert.x is a tool-kit for building reactive applications on the JVM." name=description><link href=https://vertx.io/preview/stylesheets/main.css media=screen rel=stylesheet><link href=https://vertx.io/preview/stylesheets/font-awesome.min.css media=screen rel=stylesheet><link href=https://vertx.io/preview/javascripts/styles/rainbow.min.css media=screen rel=stylesheet><!--[if lt IE 9]><script src="http://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script><![endif]--><link rel=apple-touch-icon sizes=57x57 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-180x180.png><link rel=icon type=image/png href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/favicon-16x16.png sizes=16x16><link rel=manifest href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/manifest.json><link rel=mask-icon href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content=#7d3194><meta name=msapplication-TileImage content=https://vertx.io/preview/assets/favicons/vertx-favicon-7/mstile-144x144.png><meta name=theme-color content=#ffffff><link href="https://fonts.googleapis.com/css?family=Ubuntu:400,500,700,400italic" rel=stylesheet type=text/css><link rel=alternate type=application/rss+xml title=RSS href=https://vertx.io/preview/feed.xml><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-30144458-1', 'auto');
    ga('create', 'UA-71153120-1', 'auto', 'tracker');
    ga('send', 'pageview');
    ga('tracker.send', 'pageview');</script></head><body><a href="http://www.reactivemanifesto.org/" id=reactive-manifesto-banner><img style="border: 0; position: fixed; right: 0; top:0; z-index: 9000" src=https://d379ifj7s9wntv.cloudfront.net/reactivemanifesto/images/ribbons/we-are-reactive-black-right.png></a> <a id=skippy class="sr-only sr-only-focusable" href=#content><div class=container><span class=skiplink-text>Skip to main content</span></div></a><header class="navbar navbar-default navbar-static-top" id=top role=banner><div class=container><div class=navbar-header><button class="navbar-toggle collapsed" type=button data-toggle=collapse data-target=#vertx-navbar-collapse><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="https://vertx.io/preview/" class=navbar-brand><img alt=Brand src=https://vertx.io/preview/assets/logo-sm.png></a></div><nav class="collapse navbar-collapse" id=vertx-navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=http://start.vertx.io>Starter</a></li><li><a href="https://vertx.io/preview/download/">Download</a></li><li><a href="https://vertx.io/preview/docs/">Documentation</a></li><li><a href=https://github.com/vert-x3/wiki/wiki>Wiki</a></li><li><a href="https://vertx.io/preview/community/">Community</a></li><li><a href="https://vertx.io/preview/materials/">Materials</a></li><li><a href="https://vertx.io/preview/blog/">Blog</a></li></ul></nav></div></header><div class=container><div class="row blog"><article class="col-xs-12 blog-post"><h2 class=blog-post-title>TCP Client using Eclipse Vert.x, Kotlin and Gradle build</h2><p class=blog-post-meta>20th December 2017 by <a href=http://github.com/usmansaleem>usmansaleem</a></p><article><p>As part of my hobby project to control RaspberryPi using Google Home Mini and/or Alexa, I wanted to write a very simple TCP client that keeps a connection open to one of my custom written server in cloud (I will write another blog post to cover the server side on a later date). The requirement of the client is to send a shared secret upon connecting and then keep waiting for message from server. Vert.x, Kotlin and Gradle allow rapid development of such project. The generated jar can be executed on Raspberry Pi. These steps outline the project setup and related source code to showcase a Vert.x and Kotlin project with Gradle.</p><h2 id=project-directory-structure>Project Directory Structure</h2><p>From command line (or via Windows Explorer, whatever you prefer to use) create a directory for project,for instance <code>vertx-net-client</code>. Since we are using Kotlin, we will place all Kotlin files in <code>src/main/kotlin</code> folder. The <code>src/main/resources</code> folder will contain our logging configuration related files.</p><pre><code class=hljs><span class=hljs-built_in>cd</span> vertx-<span class=hljs-winutils>net</span>-client
<span class=hljs-built_in>mkdir</span> -p src/main/kotlin
<span class=hljs-built_in>mkdir</span> -p src/main/resources</code></pre><h3 id=project-files>Project Files</h3><p>We need to add following files in the project</p><ul><li><code>.gitignore</code> If you want to check your project into git, you may consider adding following <code>.gitignore</code> file at root of your project</li></ul><script src=https://gist.github.com/usmansaleem/b5838484a20cb8b08f236f2265ad7a8e.js></script><ul><li><code>logback.xml</code> This example is using slf4j and logback for logging. If you decide to use it in your project, you may also add following logback.xml file in <code>src/main/resources</code>. Modify it as per your requirements. This example will log on console.</li></ul><script src=https://gist.github.com/usmansaleem/750c6d1cad0721b52be2ff00f758fb9f.js></script><h2 id=gradle-setup>Gradle Setup</h2><p>We will use Gradle build system for this project. If you don’t already have Gradle available on your system, download and unzip gradle in a directory of your choice (<code>$GRADLE_HOME</code> is used here to represent this directory). This gradle distribution will be used as a starting point to create Gradle wrapper scripts for our project. These scripts will allow our project to download and use correct version of gradle distribution automatically without messing up system. Really useful when building your project on CI tool or on any other developer’s machine.</p><p>Run following command in project’s directory</p><pre><code class=hljs><span class=hljs-variable>$GRADLE_HOME</span>/bin/gradle wrapper</code></pre><p>The above commands will generate following files and directories.</p><pre><code class=hljs>gradle/  gradlew  gradlew.bat</code></pre><h3 id=gradle-build-file-build-gradle->Gradle build file <code>build.gradle</code></h3><p>Create (and/or copy and modify) following <code>build.gradle</code> in your project’s root directory. Our example gradle build file is using <a href="https://github.com/jponge/vertx-gradle-plugin/">vertx-gradle-plugin</a>.</p><script src=https://gist.github.com/usmansaleem/e723f25b827e0a925eaef2957a80132d.js></script><p>In the project directory, run following command to download local gradle distribution:</p><pre><code class=hljs>./gradlew</code></pre>(or `.\gradlew.bat` if in Windows) At this stage we should have following file structure. This is also a good time to commit changes if you are working with git. * `.gitignore` * `build.gradle` * `gradle/wrapper/gradle-wrapper.jar` * `gradle/wrapper/gradle-wrapper.properties` * `gradlew` * `gradlew.bat` * `src/main/resources/logback.xml` Now that our project structure is ready, time to add the meat of the project. You may use any IDE of your choice. My preference is IntelliJ IDEA. Create a new package under `src/main/kotlin`. The package name should be adapted from the following section of `build.gradle`<pre><code class=hljs><span class=hljs-title>vertx</span> {
    <span class=hljs-title>mainVerticle</span> = <span class=hljs-string>"info.usmans.blog.vertx.NetClientVerticle"</span>
}</code></pre><p>From the above example, the package name is <code>info.usmans.blog.vertx</code></p><p>Add a new Kotlin Class/file in <code>src/main/kotlin/info/usmans/blog/vertx</code> as <code>NetClientVerticle.kt</code></p><p>The contents of this class is as follows</p><script src=https://gist.github.com/usmansaleem/2a176a7b752fcb72f7f31964809696fe.js></script><h2 id=explaining-the-code>Explaining the Code</h2><p>The <code>fun main(args: Array&lt;String&gt;)</code> is not strictly required, it quickly allows running the Vert.x verticle from within IDE. You will also notice a small hack in the method for setting system property <code>vertx.disableDnsResolver</code> which is to avoid a Netty bug that I observed when running on Windows machine and remote server is down. Of course, since we are using vertx-gradle-plugin, we can also use <code>gradle vertxRun</code> to run our verticle. In this case the <code>main</code> method will not get called.</p><p>The <code>override fun start()</code> method calls <code>fireReconnectTimer</code> which in turn calls <code>reconnect</code> method. <code>reconnect</code> method contains the connection logic to server as well as it calls <code>fireReconnectTimer</code> if it is unable to connect to server or disconnects from server. In <code>reconnect</code> method the <code>socket.handler</code> gets called when server send message to client.</p><pre><code class=hljs>socket.handler({ data -&gt;
                        logger.info(<span class=hljs-string>"Data received: ${data}"</span>)
                        //TODO: Do the work here <span class=hljs-keyword>...</span>
               })</code></pre><h2 id=distributing-the-project>Distributing the project</h2><p>To create redistributable jar, use <code>./gradlew shadowJar</code> command. Or if using IntelliJ: from Gradle projects, Tasks, shadow, shadowJar (right click run). This command will generate <code>./build/libs/vertx-net-client-fat.jar</code>.</p><h3 id=executing-the-client>Executing the client</h3><p>The client jar can be executed using following command:</p><pre><code class=hljs>java <span class=hljs-variable>-DserverHost=</span><span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span> <span class=hljs-variable>-DserverPort=</span><span class=hljs-number>8888</span> <span class=hljs-variable>-DconnectMessage=</span><span class=hljs-string>"hello"</span> -jar vertx-net-client-full.jar</code></pre><p>If you wish to use SLF4J for Vert.x internal logging, you need to pass system property <code>vertx.logger-delegate-factory-class-name</code> with value of <code>io.vertx.core.logging.SLF4JLogDelegateFactory</code>. The final command would look like:</p><pre><code class=hljs>java <span class=hljs-variable>-DserverHost=</span><span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span> <span class=hljs-variable>-DserverPort=</span><span class=hljs-number>8888</span> <span class=hljs-variable>-DconnectMessage=</span><span class=hljs-string>"hello"</span> -Dvertx.<span class=hljs-variable>logger-delegate-factory-class-name=</span><span class=hljs-string>"io.vertx.core.logging.SLF4JLogDelegateFactory"</span> -jar vertx-net-client-full.jar</code></pre><p>You can configure Vert.x logging levels in logback.xml file if required.</p><h2 id=conclusion>Conclusion</h2><p>This post describes how easy it is to create a simple TCP client using Vert.x, Kotlin and Gradle build system. Hopefully the techniques shown here will serve as a starting point for your next DIY project.</p><p><div class="admonition-block info"><table><tbody><tr><td class=admonition-icon><i class="admonition-icon fa fa-info-circle"></i></td><td class=content><span class=title>Info</span><br><span class=content>This post is adapted and reproduced from <a href=https://usmans.info/usmansaleem/blog/tcp_client_using_vertx_kotlin_gradle>author’s blog post</a></span></td></tr></tbody></table></div></p></article></article></div><div class=row><div class=col-xs-12 id=disqus_thread></div></div><script>var disqus_config = function () {
  this.page.url = "https://vertx.io/preview/blog/tcp-client-using-eclipse-vert-x-kotlin-and-gradle-build/";
  this.page.identifier = "/blog/tcp-client-using-eclipse-vert-x-kotlin-and-gradle-build/";
  };
  (function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://vertx.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><footer><div class=container><div class=row><div class="col-xs-4 col-sm-4 col-md-2 col-lg-2"><h2>Eclipse Vert.x</h2><ul class=list-unstyled><li><a href="https://vertx.io/preview/">Home</a></li><li><a href="https://vertx.io/preview/download/">Download</a></li><li><a href="https://vertx.io/preview/docs/">Documentation</a></li><li><a href=https://github.com/vert-x3/wiki/wiki>Wiki</a></li><li><a href="https://vertx.io/preview/blog/">Blog</a></li><li><a href="https://vertx.io/preview/vertx2/" class=vertx-2-link>Vert.x 2</a></li></ul></div><div class="col-xs-4 col-sm-4 col-md-2 col-lg-2"><h2>Community</h2><ul class=list-unstyled><li><a href="https://vertx.io/preview/community/">Help &amp; Contributors</a></li><li><a href="https://vertx.io/preview/materials/">Learning materials</a></li><li><a href=https://groups.google.com/forum/?fromgroups#!forum/vertx>User Group</a></li><li><a href=https://groups.google.com/forum/?fromgroups#!forum/vertx-dev>Developer Group</a></li></ul></div><div class="col-xs-4 col-sm-4 col-md-2 col-lg-2"><h2>Eclipse</h2><ul class=list-unstyled><li><a href="http://www.eclipse.org/">Eclipse Foundation</a></li><li><a href=https://eclipse.org/legal/privacy.php>Privacy Policy</a></li><li><a href=https://eclipse.org/legal/termsofuse.php>Terms of Use</a></li><li><a href=https://eclipse.org/legal/copyright.php>Copyright Agent</a></li><li><a href=http://www.eclipse.org/legal>Legal Resources</a></li></ul></div><div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 copyright"><p>Eclipse Vert.x is open source and dual-licensed under the <a href=http://www.eclipse.org/legal/epl-v20.html>Eclipse Public License 2.0</a> and <a href=https://www.apache.org/licenses/LICENSE-2.0.html>Apache License 2.0</a>.</p><p>This website is licensed under the <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0 License</a>.<br>Design by <a href=https://www.michel-kraemer.com>Michel Kr&auml;mer</a>.</p><div class=row><div class="col-sm-12 col-md-5 col-md-offset-1 col-lg-offset-2"><a href=http://eclipse.org><img class="logo eclipse-logo" src=https://vertx.io/preview/assets/eclipse_logo_grey_small.png width=204 height=48></a></div><div class="col-sm-12 col-md-5 col-md-offset-1 col-lg-offset-0"><a href=http://cloudbees.com><img class="logo cloudbees-logo" src=https://vertx.io/preview/assets/Button-Built-on-CB-1-grey.png width=180 height=48></a></div><div class="col-sm-12 col-md-5 col-md-offset-7 jprofiler"><a href=http://www.ej-technologies.com/products/jprofiler/overview.html style=text-decoration:none><img class="logo jprofiler-logo" src=https://vertx.io/preview/assets/jprofiler-logo.png width=48 height=48><span class=jprofiler-logo>&nbsp; JPROFILER</span></a></div></div></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js></script><script src=https://vertx.io/preview/javascripts/bootstrap.min.js></script><script src=https://vertx.io/preview/javascripts/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>