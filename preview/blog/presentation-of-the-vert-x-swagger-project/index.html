<!DOCTYPE html><html lang=en><head><title>Presentation of the Vert.x-Swagger project</title><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta content="width=device-width,initial-scale=1" name=viewport><meta content="Eclipse Vert.x is a tool-kit for building reactive applications on the JVM." name=description><link href=https://vertx.io/preview/stylesheets/main.css media=screen rel=stylesheet><link href=https://vertx.io/preview/stylesheets/font-awesome.min.css media=screen rel=stylesheet><link href=https://vertx.io/preview/javascripts/styles/rainbow.min.css media=screen rel=stylesheet><!--[if lt IE 9]><script src="http://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script><![endif]--><link rel=apple-touch-icon sizes=57x57 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/apple-touch-icon-180x180.png><link rel=icon type=image/png href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/favicon-16x16.png sizes=16x16><link rel=manifest href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/manifest.json><link rel=mask-icon href=https://vertx.io/preview/assets/favicons/vertx-favicon-7/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content=#7d3194><meta name=msapplication-TileImage content=https://vertx.io/preview/assets/favicons/vertx-favicon-7/mstile-144x144.png><meta name=theme-color content=#ffffff><link href="https://fonts.googleapis.com/css?family=Ubuntu:400,500,700,400italic" rel=stylesheet type=text/css><link rel=alternate type=application/rss+xml title=RSS href=https://vertx.io/preview/feed.xml><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-30144458-1', 'auto');
    ga('create', 'UA-71153120-1', 'auto', 'tracker');
    ga('send', 'pageview');
    ga('tracker.send', 'pageview');</script></head><body><a href="http://www.reactivemanifesto.org/" id=reactive-manifesto-banner><img style="border: 0; position: fixed; right: 0; top:0; z-index: 9000" src=https://d379ifj7s9wntv.cloudfront.net/reactivemanifesto/images/ribbons/we-are-reactive-black-right.png></a> <a id=skippy class="sr-only sr-only-focusable" href=#content><div class=container><span class=skiplink-text>Skip to main content</span></div></a><header class="navbar navbar-default navbar-static-top" id=top role=banner><div class=container><div class=navbar-header><button class="navbar-toggle collapsed" type=button data-toggle=collapse data-target=#vertx-navbar-collapse><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="https://vertx.io/preview/" class=navbar-brand><img alt=Brand src=https://vertx.io/preview/assets/logo-sm.png></a></div><nav class="collapse navbar-collapse" id=vertx-navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=http://start.vertx.io>Starter</a></li><li><a href="https://vertx.io/preview/download/">Download</a></li><li><a href="https://vertx.io/preview/docs/">Documentation</a></li><li><a href=https://github.com/vert-x3/wiki/wiki>Wiki</a></li><li><a href="https://vertx.io/preview/community/">Community</a></li><li><a href="https://vertx.io/preview/materials/">Materials</a></li><li><a href="https://vertx.io/preview/blog/">Blog</a></li></ul></nav></div></header><div class=container><div class="row blog"><article class="col-xs-12 blog-post"><h2 class=blog-post-title>Presentation of the Vert.x-Swagger project</h2><p class=blog-post-meta>22nd May 2017 by <a href=http://github.com/phiz71>phiz71</a></p><article><p>This post is an introduction to the <a href=https://github.com/phiz71/vertx-swagger>Vert.x-Swagger</a> project, and describe how to use the <code>Swagger-Codegen</code> plugin and the <code>SwaggerRouter</code> class.</p><h2 id=eclipse-vert-x-swagger>Eclipse Vert.x &amp; Swagger</h2><p><a href="http://vertx.io/docs/vertx-core/java/">Vert.x</a> and <a href="http://vertx.io/docs/vertx-web/java/">Vert.x Web</a> are very convenient to write REST API and especially the <a href=http://vertx.io/docs/apidocs/io/vertx/ext/web/Router.html>Router</a> which is very useful to manage all resources of an API.</p><p>But when I start a new API, I usually use the “design-first” approach and <a href="http://swagger.io/specification/">Swagger</a> is my best friend to define what my API is supposed to do. And then, comes the “boring” part of the job : convert the swagger file content into java code. That’s always the same : resources, operations, models…</p><p>Fortunately, Swagger provides a codegen tool : <a href=https://github.com/swagger-api/swagger-codegen>Swagger-Codegen</a>. With this tool, you can generate a server stub based on your swagger definition file. However, even if this generator provides many different languages and framework, Vert.X is missing.</p><p>This is where the <a href=https://github.com/phiz71/vertx-swagger>Vert.x-Swagger</a> project comes in.</p><h2 id=the-project>The project</h2><p><strong>Vert.x-Swagger</strong> is a maven project providing 2 modules.</p><h3 id=vertx-swagger-codegen>vertx-swagger-codegen</h3><p>It’s a <a href=https://github.com/swagger-api/swagger-codegen>Swagger-Codegen</a> plugin, which add the capability of generating a Java Vert.x WebServer to the generator.</p><p>The generated server mainly contains :</p><ul><li>POJOs for <code>definitions</code></li><li>one Verticle per <code>tag</code></li><li>one MainVerticle, which manage others APIVerticle and start an HttpServer.</li></ul><p><div class="admonition-block note"><table><tbody><tr><td class=admonition-icon><i class="admonition-icon fa fa-comment"></i></td><td class=content><span class=content>the MainVerticle use <em>vertx-swagger-router</em></span></td></tr></tbody></table></div></p><h3 id=vertx-swagger-router>vertx-swagger-router</h3><p>The main class of this module is <code>SwaggerRouter</code>. It’s more or less a <em>Factory</em> (and maybe I should rename the class) that can create a <a href=http://vertx.io/docs/apidocs/io/vertx/ext/web/Router.html>Router</a>, using the swagger definition file to configure all the routes. For each route, it extracts parameters from the request (<code>Query</code>, <code>Path</code>, <code>Header</code>, <code>Body</code>, <code>Form</code>) and send them on the eventBus, using either the <code>operationId</code> as the address or a computed id (just a parameter in the constructor).</p><h2 id=let-see-how-it-works>Let see how it works</h2><p><div class="admonition-block info"><table><tbody><tr><td class=admonition-icon><i class="admonition-icon fa fa-info-circle"></i></td><td class=content><span class=content>For this post, I will use a simplified swagger file but you can find a more complex example <a href=https://github.com/phiz71/vertx-swagger/tree/master/sample/petstore-vertx-server>here</a> based on the <a href="http://petstore.swagger.io/">petstore</a> swagger file</span></td></tr></tbody></table></div></p><h3 id=generating-the-server>Generating the server</h3><p>First, choose your swagger definition. Here’s a YAML File, but it could be a JSON file :</p><script src=https://gist.github.com/phiz71/6c654f3da2d4124d3fe65e5aaaaedf55.js></script><p>Then, download these libraries :</p><ul><li><a href=http://central.maven.org/maven2/io/swagger/swagger-codegen-cli/2.2.2/swagger-codegen-cli-2.2.2.jar>swagger-codegen-cli</a></li><li><a href=http://central.maven.org/maven2/com/github/phiz71/vertx-swagger-codegen/1.0.0/vertx-swagger-codegen-1.0.0.jar>vertx-swagger-codegen</a></li></ul><p>Finally, run this command</p><pre><code class="hljs bash">java -cp /path/to/swagger-codegen-cli-<span class=hljs-number>2.2</span>.<span class=hljs-number>2</span>.jar:/path/to/vertx-swagger-codegen-<span class=hljs-number>1.0</span>.<span class=hljs-number>0</span>.jar io.swagger.codegen.SwaggerCodegen generate \
  <span class=hljs-operator>-l</span> java-vertx \
  -o path/to/destination/folder \
  -i path/to/swagger/definition \
  --group-id your.group.id \
  --artifact-id your.artifact.id</code></pre><p><div class="admonition-block info"><table><tbody><tr><td class=admonition-icon><i class="admonition-icon fa fa-info-circle"></i></td><td class=content><span class=title>For more Information about how SwaggerCodegen works</span><br><span class=content>you can read this <a href=https://github.com/swagger-api/swagger-codegen#getting-started>https://github.com/swagger-api/swagger-codegen#getting-started</a></span></td></tr></tbody></table></div></p><p>You should have something like that in your console:</p><p><pre><code class=hljs>[main] INFO io<span class=hljs-class>.swagger</span><span class=hljs-class>.parser</span><span class=hljs-class>.Swagger20Parser</span> - reading from ./wineCellarSwagger<span class=hljs-class>.yaml</span>
[main] INFO io<span class=hljs-class>.swagger</span><span class=hljs-class>.codegen</span><span class=hljs-class>.AbstractGenerator</span> - writing file [path/to/destination/folder]/src/main/java/io/swagger/server/api/model/Bottle<span class=hljs-class>.java</span>
[main] INFO io<span class=hljs-class>.swagger</span><span class=hljs-class>.codegen</span><span class=hljs-class>.AbstractGenerator</span> - writing file [path/to/destination/folder]/src/main/java/io/swagger/server/api/model/CellarInformation<span class=hljs-class>.java</span>
[main] INFO io<span class=hljs-class>.swagger</span><span class=hljs-class>.codegen</span><span class=hljs-class>.AbstractGenerator</span> - writing file [path/to/destination/folder]/src/main/java/io/swagger/server/api/verticle/BottlesApi<span class=hljs-class>.java</span>
[main] INFO io<span class=hljs-class>.swagger</span><span class=hljs-class>.codegen</span><span class=hljs-class>.AbstractGenerator</span> - writing file [path/to/destination/folder]/src/main/java/io/swagger/server/api/verticle/BottlesApiVerticle<span class=hljs-class>.java</span>
[main] INFO io<span class=hljs-class>.swagger</span><span class=hljs-class>.codegen</span><span class=hljs-class>.AbstractGenerator</span> - writing file [path/to/destination/folder]/src/main/java/io/swagger/server/api/verticle/InformationApi<span class=hljs-class>.java</span>
[main] INFO io<span class=hljs-class>.swagger</span><span class=hljs-class>.codegen</span><span class=hljs-class>.AbstractGenerator</span> - writing file [path/to/destination/folder]/src/main/java/io/swagger/server/api/verticle/InformationApiVerticle<span class=hljs-class>.java</span>
[main] INFO io<span class=hljs-class>.swagger</span><span class=hljs-class>.codegen</span><span class=hljs-class>.AbstractGenerator</span> - writing file [path/to/destination/folder]/src/main/resources/swagger<span class=hljs-class>.json</span>
[main] INFO io<span class=hljs-class>.swagger</span><span class=hljs-class>.codegen</span><span class=hljs-class>.AbstractGenerator</span> - writing file [path/to/destination/folder]/src/main/java/io/swagger/server/api/MainApiVerticle<span class=hljs-class>.java</span>
[main] INFO io<span class=hljs-class>.swagger</span><span class=hljs-class>.codegen</span><span class=hljs-class>.AbstractGenerator</span> - writing file [path/to/destination/folder]/src/main/resources/vertx-default-jul-logging<span class=hljs-class>.properties</span>
[main] INFO io<span class=hljs-class>.swagger</span><span class=hljs-class>.codegen</span><span class=hljs-class>.AbstractGenerator</span> - writing file [path/to/destination/folder]/pom<span class=hljs-class>.xml</span>
[main] INFO io<span class=hljs-class>.swagger</span><span class=hljs-class>.codegen</span><span class=hljs-class>.AbstractGenerator</span> - writing file [path/to/destination/folder]/README<span class=hljs-class>.md</span>
[main] INFO io<span class=hljs-class>.swagger</span><span class=hljs-class>.codegen</span><span class=hljs-class>.AbstractGenerator</span> - writing file [path/to/destination/folder]/.swagger-codegen-ignore</code></pre>And this in your destination folder:</p><p><img src=/assets/blog/vertx-swagger-presentation/GeneratedProject.png alt="Generated sources"></p><h3 id=what-have-been-created->What have been created ?</h3><p>As you can see in <strong>1</strong>, the <em>vertx-swagger-codegen</em> plugin has created one POJO by <code>definition</code> in the swagger file.</p><h4 id=example-the-bottle-definition>Example : the bottle definition</h4><script src=https://gist.github.com/phiz71/eabafda440b24881126089128d677121.js></script><p>In <strong>2a</strong> and <strong>2b</strong> you can find :</p><ul><li>an interface which contains a function per <code>operation</code></li><li>a verticle which defines all <code>operationId</code> and create <a href=http://vertx.io/docs/vertx-core/java/#_the_event_bus_api>EventBus</a> consumers</li></ul><h4 id=example-the-bottles-interface>Example : the Bottles interface</h4><script src=https://gist.github.com/phiz71/be1ca2f550f44aea7fb2710b383e26ed.js></script><h4 id=example-the-bottles-verticle>Example : the Bottles verticle</h4><script src=https://gist.github.com/phiz71/c0aadbb4f26ebed8e2e145d0b4a8d210.js></script><h3 id=-and-now->… and now ?</h3><p>Line <code>23</code> of <code>BottlesApiVerticle.java</code>, you can see this</p><p><pre><code class="hljs java">BottlesApi service = <span class=hljs-keyword>new</span> BottlesApiImpl();</code></pre>This line will not compile until the <code>BottlesApiImpl</code> class is created.</p><p>In all <strong>XXXAPI</strong>Verticles, you will find a variable called <em>service</em>. It is a <strong>XXXAPI</strong> type and it is instanciated with a <strong>XXXAPI</strong>Impl contructor. This class does not exist yet since it is the business of your API.</p><p><strong>And so you will have to create these implementations.</strong></p><h2 id=fine-but-what-if-i-don-t-want-to-build-my-api-like-this->Fine, but what if I don’t want to build my API like this ?</h2><p>Well, Vert.x is <strong>unopinionated</strong> but the way the <em>vertx-swagger-codegen</em> creates the server stub <strong>is not</strong>. So if you want to implement your API the way you want, while enjoying dynamic routing based on a swagger file, the <em>vertx-swagger-router</em> library can be used standalone.</p><p>Just import this jar into your project :</p><script src=https://gist.github.com/phiz71/56e723362a1d1370c7262bff246fb087.js></script><p>You will be able to create your <a href=http://vertx.io/docs/apidocs/io/vertx/ext/web/Router.html>Router</a> like this :</p><p><pre><code class="hljs java">FileSystem vertxFileSystem = vertx.fileSystem();
vertxFileSystem.readFile(<span class=hljs-string>“<strong><em>YOUR_SWAGGER_FILE</em></strong>“</span>, readFile -&gt; {
    <span class=hljs-keyword>if</span> (readFile.succeeded()) {
        Swagger swagger = <span class=hljs-keyword>new</span> SwaggerParser().parse(readFile.result().toString(Charset.forName(<span class=hljs-string>“utf-8”</span>))); 
        Router swaggerRouter = SwaggerRouter.swaggerRouter(Router.router(vertx), swagger, vertx.eventBus(), <span class=hljs-keyword>new</span> OperationIdServiceIdResolver());
        […]
   } <span class=hljs-keyword>else</span> {
        […]
   }
});</code></pre><div class="admonition-block note"><table><tbody><tr><td class=admonition-icon><i class="admonition-icon fa fa-comment"></i></td><td class=content><span class=content>You can ignore the last parameter in <code>SwaggerRouter.swaggerRouter(...)</code>. As a result, addresses will be computed instead of using <code>operationId</code> from the swagger file. For instance, <code>GET /bottles/{bottle_id}</code> will become <em>GET_bottles_bottle-id</em></span></td></tr></tbody></table></div></p><h2 id=conclusion>Conclusion</h2><p>Vert.x and Swagger are great tools to build and document an API but using both in the same project can be painful. The <a href=https://github.com/phiz71/vertx-swagger>Vert.x-Swagger</a> project was made to save time, letting the developers focusing on business code. It can be seen as an API framework over Vert.X.</p><p>You can also use the <code>SwaggerRouter</code> in your own project without using Swagger-Codegen.</p><p>In future releases, more information from the swagger file will be used to configure the router and certainly others languages will be supported.</p><p><div class="admonition-block note"><table><tbody><tr><td class=admonition-icon><i class="admonition-icon fa fa-comment"></i></td><td class=content><span class=content>Though Vert.x is polyglot, Vert.x-Swagger project only supports Java. If you want to contribute to support more languages, you’re welcome :)</span></td></tr></tbody></table></div></p><p>Thanks for reading.</p><style type=text/css>.gist-file
  .gist-data {max-height: 500px}</style></article></article></div><div class=row><div class=col-xs-12 id=disqus_thread></div></div><script>var disqus_config = function () {
  this.page.url = "https://vertx.io/preview/blog/presentation-of-the-vert-x-swagger-project/";
  this.page.identifier = "/blog/presentation-of-the-vert-x-swagger-project/";
  };
  (function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://vertx.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><footer><div class=container><div class=row><div class="col-xs-4 col-sm-4 col-md-2 col-lg-2"><h2>Eclipse Vert.x</h2><ul class=list-unstyled><li><a href="https://vertx.io/preview/">Home</a></li><li><a href="https://vertx.io/preview/download/">Download</a></li><li><a href="https://vertx.io/preview/docs/">Documentation</a></li><li><a href=https://github.com/vert-x3/wiki/wiki>Wiki</a></li><li><a href="https://vertx.io/preview/blog/">Blog</a></li><li><a href="https://vertx.io/preview/vertx2/" class=vertx-2-link>Vert.x 2</a></li></ul></div><div class="col-xs-4 col-sm-4 col-md-2 col-lg-2"><h2>Community</h2><ul class=list-unstyled><li><a href="https://vertx.io/preview/community/">Help &amp; Contributors</a></li><li><a href="https://vertx.io/preview/materials/">Learning materials</a></li><li><a href=https://groups.google.com/forum/?fromgroups#!forum/vertx>User Group</a></li><li><a href=https://groups.google.com/forum/?fromgroups#!forum/vertx-dev>Developer Group</a></li></ul></div><div class="col-xs-4 col-sm-4 col-md-2 col-lg-2"><h2>Eclipse</h2><ul class=list-unstyled><li><a href="http://www.eclipse.org/">Eclipse Foundation</a></li><li><a href=https://eclipse.org/legal/privacy.php>Privacy Policy</a></li><li><a href=https://eclipse.org/legal/termsofuse.php>Terms of Use</a></li><li><a href=https://eclipse.org/legal/copyright.php>Copyright Agent</a></li><li><a href=http://www.eclipse.org/legal>Legal Resources</a></li></ul></div><div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 copyright"><p>Eclipse Vert.x is open source and dual-licensed under the <a href=http://www.eclipse.org/legal/epl-v20.html>Eclipse Public License 2.0</a> and <a href=https://www.apache.org/licenses/LICENSE-2.0.html>Apache License 2.0</a>.</p><p>This website is licensed under the <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0 License</a>.<br>Design by <a href=https://www.michel-kraemer.com>Michel Kr&auml;mer</a>.</p><div class=row><div class="col-sm-12 col-md-5 col-md-offset-1 col-lg-offset-2"><a href=http://eclipse.org><img class="logo eclipse-logo" src=https://vertx.io/preview/assets/eclipse_logo_grey_small.png width=204 height=48></a></div><div class="col-sm-12 col-md-5 col-md-offset-1 col-lg-offset-0"><a href=http://cloudbees.com><img class="logo cloudbees-logo" src=https://vertx.io/preview/assets/Button-Built-on-CB-1-grey.png width=180 height=48></a></div><div class="col-sm-12 col-md-5 col-md-offset-7 jprofiler"><a href=http://www.ej-technologies.com/products/jprofiler/overview.html style=text-decoration:none><img class="logo jprofiler-logo" src=https://vertx.io/preview/assets/jprofiler-logo.png width=48 height=48><span class=jprofiler-logo>&nbsp; JPROFILER</span></a></div></div></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js></script><script src=https://vertx.io/preview/javascripts/bootstrap.min.js></script><script src=https://vertx.io/preview/javascripts/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>